META:
  description: Translate frequently reused phrases with caching behaviour.
  id: com.example.translator
  profiles:
    default:
      cache:
        scope: shared
        strategy: simple
        ttl: 1h
      cost_budget: 0.05
      max_output_tokens: 256
      model: claude-3-haiku-20240307
      provider: anthropic
      temperature: 0.3
  repro: loose
  version: 1.0.0

INPUT:
  language:
    description: Target language in plain English.
    required: true
    type: string
  phrase:
    description: Phrase to translate.
    required: true
    type: string

OUTPUT:
  grammar:
  json_schema:
    $id: schema:com.example.translator:output
    schema:
      additionalProperties: false
      properties:
        translation:
          type: string
      required:
      - translation
      type: object
    version: '2024-05-01'
  regex:

POLICY:
  imports:
  - id: policy.global.translation
    version: '>=1.0.0'
  local:
    safety_checks:
    - ensure: no_offensive_language
      message: Filter out profanity before returning the translation.

PIPELINE:
  steps:
  - expects:
      translation: string
    id: translate
    inputs:
      language: $input.language
      phrase: $input.phrase
    outputs:
      translation: string
    uses: module.com.translation@^1.3.0

TEST:
  - name: Second call with same input should be cached
    input:
      phrase: Hello
      language: French
    steps:
    - name: first_run
      mock_output:
        translation: Bonjour
      assert:
      - type: schema
      - type: was_cached
        value: false
    - name: second_run
      mock_output:
        translation: Bonjour
      assert:
      - type: schema
      - type: was_cached
        value: true
    - name: run_with_different_input
      input:
        language: Spanish
      mock_output:
        translation: Hola
      assert:
      - type: schema
      - type: was_cached
        value: false
